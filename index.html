<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cat√°logo de Pastillas</title>
<style>
body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
input { padding: 10px; width: 60%; border: 1px solid #ccc; border-radius: 5px; }
table { border-collapse: collapse; width: 100%; margin-top: 15px; background: white; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #007bff; color: white; }
tr:nth-child(even) { background-color: #f2f2f2; }
img { width: 80px; height: auto; border-radius: 5px; }
</style>
</head>
<body>

<h2>üîç Cat√°logo de Pastillas Incolbest</h2>
<input type="text" id="busqueda" placeholder="Busca por marca, modelo, a√±o o referencia...">
<div id="resultados"></div>

<script>
async function cargarDatos() {
  const response = await fetch('data/pastillas.csv');
  const texto = await response.text();
  const filas = texto.trim().split('\n');
  const encabezados = filas[0].split(',');
  const datos = filas.slice(1).map(fila => {
    const valores = fila.split(',');
    const registro = {};
    encabezados.forEach((col, i) => registro[col.trim()] = valores[i] ? valores[i].trim() : '');
    return registro;
  });
  return datos;
}

async function buscar() {
  const input = document.getElementById('busqueda').value.toLowerCase();
  const resultadosDiv = document.getElementById('resultados');
  resultadosDiv.innerHTML = '';
  
  const datos = await cargarDatos();
  const filtrados = datos.filter(item =>
    Object.values(item).some(valor => valor.toLowerCase().includes(input))
  );
  
  if (filtrados.length === 0) {
    resultadosDiv.innerHTML = '<p>‚ùå No se encontr√≥ ninguna coincidencia.</p>';
    return;
  }
  
  let tabla = '<table><tr><th>Marca</th><th>Modelo</th><th>Desde</th><th>Hasta</th><th>Posici√≥n</th><th>Ref Incolbest</th><th>Platina FMSI</th><th>Imagen</th></tr>';
  filtrados.forEach(item => {
    tabla += `<tr>
      <td>${item.MARCA}</td>
      <td>${item.MODELO}</td>
      <td>${item.DESDE}</td>
      <td>${item.HASTA}</td>
      <td>${item.POSICI√ìN}</td>
      <td>${item['REF INCOLBEST']}</td>
      <td>${item['PLATINA FMSI']}</td>
      <td>${item.IMAGEN ? `<img src="${item.IMAGEN}" alt="Pastilla">` : '‚Äî'}</td>
    </tr>`;
  });
  tabla += '</table>';
  
  resultadosDiv.innerHTML = tabla;
}

document.getElementById('busqueda').addEventListener('input', buscar);
</script>

</body>
</html>